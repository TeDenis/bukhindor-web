# Active Context: Bukhindor Web

## Текущий фокус работы
Создана идеальная бесконечная анимация волны и пузырьков без видимых циклов. Анимация использует непрерывное время вместо циклических значений, что обеспечивает абсолютно плавное движение без рывков. Это обязательное условие для всех страниц приложения.

## Последние изменения

### Perfect Infinite Animation ✅
- **ОБЯЗАТЕЛЬНОЕ УСЛОВИЕ**: Использовать непрерывное время вместо циклических значений
- **Волна**: `DateTime.now().millisecondsSinceEpoch / 1000.0 * waveSpeed * 2 * pi` - никаких циклов!
- **Пузырьки**: Лопаются на высоте 5% от верха экрана, распределены по всей ширине
- **Без рывков**: Никаких `animation.value` от 0 до 1 - только непрерывное время
- **Параметры**: waveSpeed = 0.5, размер пузырьков 4-10px, непрозрачность 0.7-1.0

### Universal Background Component ✅
- Создан BeerBackgroundAnimation для использования на всех страницах
- Интегрирован с AppLayout через BackgroundAnimationType.beer
- Настраиваемые параметры: покрытие 90%, отступ сверху 10%
- Анимация не реагирует на скролл (фиксированная позиция)

### Pages Integration ✅
- Обновлена SplashPage для использования BeerSplashAnimation
- Переработаны LoginPage и RegisterPage на AppLayout с пивной анимацией
- Удалены старые LiquidPainter классы
- Упрощена архитектура анимаций

### Responsive Design ✅
- Адаптивная фоновая картинка загрузки с CSS media queries
- Responsive размеры BeerSplashAnimation (80% экрана с ограничениями)
- Адаптивный owl logo (25% ширины экрана, 80-150px)
- Поддержка разных aspect ratio и размеров экранов
- Анимация pulse для фоновой картинки

### Docker Setup ✅
- Создан multi-stage Dockerfile с Flutter build и nginx runtime
- Настроен nginx.conf с поддержкой CanvasKit WebAssembly
- Добавлен docker-compose.yml для оркестрации
- Создан .dockerignore для оптимизации контекста
- Написан автоматический скрипт сборки

### CSP Configuration ✅
- Решена проблема с WebAssembly blocking
- Добавлен `unsafe-eval` для CanvasKit
- Разрешена загрузка скриптов с `https://www.gstatic.com`
- Настроены директивы для `script-src`, `worker-src`, `child-src`

## Текущие решения

### Рабочая Docker конфигурация
```nginx
Content-Security-Policy: default-src 'self' http: https: data: blob: 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com; worker-src 'self' blob:; child-src 'self' blob:;
```

### Порты
- Внутренний: 5000 (nginx)
- Внешний: 8080 (избегаем конфликта с macOS ControlCenter)

## Следующие шаги
- [x] Создание полного memory-bank
- [x] Удаление старых MD файлов  
- [x] Консолидация документации в README.md
- [x] Улучшение анимации пива с бесшовным циклом
- [x] Универсальный фоновый компонент для всех страниц
- [x] Исправление синтаксических ошибок компиляции
- [x] Адаптивная фоновая картинка загрузки
- [x] Адаптивные размеры компонентов splash экрана
- [ ] Тестирование на разных размерах экранов
- [ ] Оптимизация производительности анимаций

## Активные решения
- Docker контейнер успешно работает
- Flutter web app загружается без ошибок WebAssembly
- CSP политика корректно настроена
- Nginx оптимизирован для production
- **ИДЕАЛЬНАЯ БЕСКОНЕЧНАЯ АНИМАЦИЯ** работает на всех страницах
- **ОБЯЗАТЕЛЬНОЕ УСЛОВИЕ**: Непрерывное время для всех анимаций

## Известные особенности
- Порт 5000 занят ControlCenter на macOS, используем 8080
- CanvasKit требует `unsafe-eval` и доступ к Google CDN
- Flutter build требует пользователя отличного от root
- **КРИТИЧЕСКОЕ ПРАВИЛО**: Всегда использовать `DateTime.now().millisecondsSinceEpoch / 1000.0` для анимаций
- **ЗАПРЕЩЕНО**: Использовать `animation.value` от 0 до 1 для волн - это создает рывки
- **ОБЯЗАТЕЛЬНО**: Пузырьки лопаются на высоте 5% от верха экрана
- **ОБЯЗАТЕЛЬНО**: Распределение пузырьков по всей ширине экрана